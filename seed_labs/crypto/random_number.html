

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Pseudo Random Number Generation Lab &mdash; Network Security Lab  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="RSA Public-Key Encryption and Signature Lab" href="rsa.html" />
    <link rel="prev" title="Public-Key Infrastructure (PKI) Lab" href="pki.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Network Security Lab
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../xie/xie_labs.html">Xie Labs</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../seed_index.html">SEED Labs</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="crypto_index.html">Cryptography Labs</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="encryption.html">Secret-Key Encryption Lab</a></li>
<li class="toctree-l3"><a class="reference internal" href="hash_length_ext.html">Hash Length Extension Attack Lab</a></li>
<li class="toctree-l3"><a class="reference internal" href="md5_collision.html">MD5 Collision Attack Lab</a></li>
<li class="toctree-l3"><a class="reference internal" href="padding_oracle.html">Padding Oracle Attack Lab</a></li>
<li class="toctree-l3"><a class="reference internal" href="pki.html">Public-Key Infrastructure (PKI) Lab</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Pseudo Random Number Generation Lab</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#task-1-generate-encryption-key-in-a-wrong-way">Task 1: Generate Encryption Key in a Wrong Way</a></li>
<li class="toctree-l4"><a class="reference internal" href="#task-2-guessing-the-key">Task 2: Guessing the Key</a></li>
<li class="toctree-l4"><a class="reference internal" href="#task-3-measure-the-entropy-of-kernel">Task 3: Measure the Entropy of Kernel</a></li>
<li class="toctree-l4"><a class="reference internal" href="#task-4-get-pseudo-random-numbers-from-dev-random">Task 4: Get Pseudo Random Numbers from <code class="docutils literal notranslate"><span class="pre">/dev/random</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#task-5-get-random-numbers-from-dev-urandom">Task 5: Get Random Numbers from <code class="docutils literal notranslate"><span class="pre">/dev/urandom</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#submission">Submission</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rsa.html">RSA Public-Key Encryption and Signature Lab</a></li>
<li class="toctree-l3"><a class="reference internal" href="tls.html">Transport Layer Security (TLS) Lab</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../hardware/hardware_index.html">Hardware Labs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mobile/mobile_index.html">Mobile Security Labs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../network/network_index.html">Network Security Labs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../web/web_index.html">Web Security Labs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software/software_index.html">Software Security Labs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../website_link/web_index.html"><strong>Return To Website</strong></a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Network Security Lab</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../seed_index.html">SEED Labs</a> &raquo;</li>
        
          <li><a href="crypto_index.html">Cryptography Labs</a> &raquo;</li>
        
      <li>Pseudo Random Number Generation Lab</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="center docutils container">
Pseudo Random Number Generation Lab</div>
<div class="section" id="pseudo-random-number-generation-lab">
<h1>Pseudo Random Number Generation Lab<a class="headerlink" href="#pseudo-random-number-generation-lab" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Generating random numbers is a quite common task in security software.
In many cases, encryption keys are not provided by users, but are
instead generated inside the software. Their randomness is extremely
important; otherwise, attackers can predict the encryption key, and thus
defeat the purpose of encryption. Many developers know how to generate
random numbers (e.g. for Monte Carlo simulation) from their prior
experiences, so they use the similar methods to generate the random
numbers for security purpose. Unfortunately, a sequence of random
numbers may be good for Monte Carlo simulation, but they may be bad for
encryption keys. Developers need to know how to generate secure random
numbers, or they will make mistakes. Similar mistakes have been made in
some well-known products, including Netscape and Kerberos.</p>
<p>In this lab, students will learn why the typical random number
generation method is not appropriate for generating secrets, such as
encryption keys. They will further learn a standard way to generate
pseudo random numbers that are good for security purposes. This lab
covers the following topics:</p>
<ul class="simple">
<li>Pseudo random number generation</li>
<li>Mistakes in random number generation</li>
<li>Generating encryption key</li>
<li>The <code class="docutils literal notranslate"><span class="pre">/dev/random</span></code> and <code class="docutils literal notranslate"><span class="pre">/dev/urandom</span></code> device files</li>
</ul>
<div class="section" id="lab-environment">
<h3>Lab environment.<a class="headerlink" href="#lab-environment" title="Permalink to this headline">¶</a></h3>
<p>This lab has been tested on the SEED Ubuntu 20.04 VM. You can download a
pre-built image from the SEED website, and run the SEED VM on your own
computer. However, most of the SEED labs can be conducted on the cloud,
and you can follow our instruction to create a SEED VM on the cloud.</p>
</div>
</div>
<div class="section" id="task-1-generate-encryption-key-in-a-wrong-way">
<h2>Task 1: Generate Encryption Key in a Wrong Way<a class="headerlink" href="#task-1-generate-encryption-key-in-a-wrong-way" title="Permalink to this headline">¶</a></h2>
<p>To generate good pseudo random numbers, we need to start with something
that is random; otherwise, the outcome will be quite predictable. The
following program uses the current time as a seed for the pseudo random
number generator.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;time.h&gt;

#define KEYSIZE 16

void main()
{
  int i;
  char key[KEYSIZE];

  printf(&quot;%lld\n&quot;, (long long) time(NULL));
  srand (time(NULL));       (*@\ding{192}@*)

  for (i = 0; i&lt; KEYSIZE; i++){
     key[i] = rand()%256;
     printf(&quot;%.2x&quot;, (unsigned char)key[i]);
  }
  printf(&quot;\n&quot;);
}
</pre></div>
</div>
<p>The library function <code class="docutils literal notranslate"><span class="pre">time()</span></code> returns the time as the number of
seconds since the Epoch, <code class="docutils literal notranslate"><span class="pre">1970-01-01</span> <span class="pre">00:00:00</span> <span class="pre">+0000</span> <span class="pre">(UTC)</span></code>. Run the
code above, and describe your observations. Then, comment out Line&nbsp;, run
the program again, and describe your observations. Use the observations
in both cases to explain the purpose of the <code class="docutils literal notranslate"><span class="pre">srand()</span></code> and <code class="docutils literal notranslate"><span class="pre">time()</span></code>
functions in the code.</p>
</div>
<div class="section" id="task-2-guessing-the-key">
<h2>Task 2: Guessing the Key<a class="headerlink" href="#task-2-guessing-the-key" title="Permalink to this headline">¶</a></h2>
<p>On April 17, 2018, Alice finished her tax return, and she saved the
return (a PDF file) on her disk. To protect the file, she encrypted the
PDF file using a key generated from the program described in Task 1. She
wrote down the key in a notebook, which is securely stored in a safe. A
few month later, Bob broke into her computer and gets a copy of the
encrypted tax return. Since Alice is CEO of a big company, this file is
very valuable.</p>
<p>Bob cannot get the encryption key, but by looking around Alice’s
computer, he saw the key-generation program, and suspected that Alice’s
encryption key may be generated by the program. He also noticed the
timestamp of the encrypted file, which is <code class="docutils literal notranslate"><span class="pre">&quot;2018-04-17</span> <span class="pre">23:08:49&quot;</span></code>. He
guessed that the key may be generated within a two-hour window before
the file was created.</p>
<p>Since the file is a PDF file, which has a header. The beginning part of
the header is always the version number. Around the time when the file
was created, PDF-1.5 was the most common version, i.e., the header
starts with <code class="docutils literal notranslate"><span class="pre">%PDF-1.5</span></code>, which is 8 bytes of data. The next 8 bytes of
the data are quite easy to predict as well. Therefore, Bob easily got
the first 16 bytes of the plaintext. Based on the meta data of the
encrypted file, he knows that the file is encrypted using
<code class="docutils literal notranslate"><span class="pre">aes-128-cbc</span></code>. Since AES is a 128-bit cipher, the 16-byte plaintext
consists of one block of plaintext, so Bob knows a block of plaintext
and its matching ciphertext. Moreover, Bob also knows the Initial Vector
(IV) from the encrypted file (IV is never encrypted). Here is what Bob
knows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Plaintext:  255044462d312e350a25d0d4c5d80a34
Ciphertext: d06bf9d0dab8e8ef880660d2af65aa82
IV:         09080706050403020100A2B2C2D2E2F2
</pre></div>
</div>
<p>Your job is to help Bob find out Alice’s encryption key, so you can
decrypt the entire document. You should write a program to try all the
possible keys. If the key was generated correctly, this task will not be
possible. However, since Alice used <code class="docutils literal notranslate"><span class="pre">time()</span></code> to seed her random number
generator, you should be able to find out her key easily. You can use
the <code class="docutils literal notranslate"><span class="pre">date</span></code> command to print out the number of seconds between a
specified time and the Epoch, <code class="docutils literal notranslate"><span class="pre">1970-01-01</span> <span class="pre">00:00:00</span> <span class="pre">+0000</span> <span class="pre">(UTC)</span></code>. See
the following example.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ date -d &quot;2018-04-15 15:00:00&quot; +%s
1523818800
</pre></div>
</div>
</div>
<div class="section" id="task-3-measure-the-entropy-of-kernel">
<h2>Task 3: Measure the Entropy of Kernel<a class="headerlink" href="#task-3-measure-the-entropy-of-kernel" title="Permalink to this headline">¶</a></h2>
<p>In the virtual world, it is difficult to create randomness, i.e.,
software alone is hard to create random numbers. Most systems resort to
the physical world to gain the randomness. <code class="docutils literal notranslate"><span class="pre">Linux</span></code> gains the
randomness from the following physical resources:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>void add_keyboard_randomness(unsigned char scancode);
void add_mouse_randomness(__u32 mouse_data);
void add_interrupt_randomness(int irq);
void add_blkdev_randomness(int major);
</pre></div>
</div>
<p>The first two are quite straightforward to understand: the first one
uses the timing between key presses; the second one uses mouse movement
and interrupt timing; the third one gathers random numbers using the
interrupt timing. Of course, not all interrupts are good sources of
randomness. For example, the timer interrupt is not a good choice,
because it is predictable. However, disk interrupts are a better
measure. The last one measures the finishing time of block device
requests.</p>
<p>The randomness is measured using <em>entropy</em>, which is different from the
meaning of entropy in the information theory. Here, it simply means how
many bits of random numbers the system currently has. You can find out
how much entropy the kernel has at the current moment using the
following command.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[backgroundcolor=]
$ cat /proc/sys/kernel/random/entropy_avail
</pre></div>
</div>
<p>Let us monitor the change of the entropy by running the above command
via <code class="docutils literal notranslate"><span class="pre">watch</span></code>, which executes a program periodically, showing the output
in fullscreen. The following command runs the <code class="docutils literal notranslate"><span class="pre">cat</span></code> program every
<code class="docutils literal notranslate"><span class="pre">0.1</span></code> second.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ watch -n .1 cat /proc/sys/kernel/random/entropy_avail
</pre></div>
</div>
<p>Please run the above command. While it is running, move your mouse,
click your mouse, type somethings, read a large file, visit a website.
What activities increases the entropy significantly. Please describe
your observation in your report.</p>
</div>
<div class="section" id="task-4-get-pseudo-random-numbers-from-dev-random">
<h2>Task 4: Get Pseudo Random Numbers from <code class="docutils literal notranslate"><span class="pre">/dev/random</span></code><a class="headerlink" href="#task-4-get-pseudo-random-numbers-from-dev-random" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Linux</span></code> stores the random data collected from the physical resources
into a random pool, and then uses two devices to turn the randomness
into pseudo random numbers. These two devices are <code class="docutils literal notranslate"><span class="pre">/dev/random</span></code> and
<code class="docutils literal notranslate"><span class="pre">/dev/urandom</span></code>. They have different behaviors. The <code class="docutils literal notranslate"><span class="pre">/dev/random</span></code>
device is a blocking device. Namely, every time a random number is given
out by this device, the entropy of the randomness pool will be
decreased. When the entropy reaches zero, <code class="docutils literal notranslate"><span class="pre">/dev/random</span></code> will block,
until it gains enough randomness.</p>
<p>Let us design an experiment to observe the behavior of the
<code class="docutils literal notranslate"><span class="pre">/dev/random</span></code> device. We will use the <code class="docutils literal notranslate"><span class="pre">cat</span></code> command to keep reading
pseudo random numbers from <code class="docutils literal notranslate"><span class="pre">/dev/random</span></code>. We pipe the output to
<code class="docutils literal notranslate"><span class="pre">hexdump</span></code> for nice printing.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cat /dev/random | hexdump
</pre></div>
</div>
<p>Please run the above command and at the same time use the <code class="docutils literal notranslate"><span class="pre">watch</span></code>
command to monitor the entropy. What happens if you do not move your
mouse or type anything. Then, randomly move your mouse and see whether
you can observe any difference. Please describe and explain your
observations.</p>
<div class="section" id="question">
<h3>Question:<a class="headerlink" href="#question" title="Permalink to this headline">¶</a></h3>
<p>If a server uses <code class="docutils literal notranslate"><span class="pre">/dev/random</span></code> to generate the random session key with
a client. Please describe how you can launch a Denial-Of-Service (DOS)
attack on such a server.</p>
</div>
</div>
<div class="section" id="task-5-get-random-numbers-from-dev-urandom">
<h2>Task 5: Get Random Numbers from <code class="docutils literal notranslate"><span class="pre">/dev/urandom</span></code><a class="headerlink" href="#task-5-get-random-numbers-from-dev-urandom" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Linux</span></code> provides another way to access the random pool via the
<code class="docutils literal notranslate"><span class="pre">/dev/urandom</span></code> device, except that this device will not block. Both
<code class="docutils literal notranslate"><span class="pre">/dev/random</span></code> and <code class="docutils literal notranslate"><span class="pre">/dev/urandom</span></code> use the random data from the pool
to generate pseudo random numbers. When the entropy is not sufficient,
<code class="docutils literal notranslate"><span class="pre">/dev/random</span></code> will pause, while <code class="docutils literal notranslate"><span class="pre">/dev/urandom</span></code> will keep generating
new numbers. Think of the data in the pool as the “seed”, and as we
know, we can use a seed to generate as many pseudo random numbers as we
want.</p>
<p>Let us see the behavior of <code class="docutils literal notranslate"><span class="pre">/dev/urandom</span></code>. We again use <code class="docutils literal notranslate"><span class="pre">cat</span></code> to get
pseudo random numbers from this device. Please run the following
command, and the describe whether moving the mouse has any effect on the
outcome.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cat /dev/urandom | hexdump
</pre></div>
</div>
<p>Let us measure the quality of the random number. We can use a tool
called <code class="docutils literal notranslate"><span class="pre">ent</span></code>, which has already been installed in our VM. According to
its manual, “<code class="docutils literal notranslate"><span class="pre">ent</span></code> applies various tests to sequences of bytes stored
in files and reports the results of those tests. The program is useful
for evaluating pseudo-random number generators for encryption and
statistical sampling applications, compression algorithms, and other
applications where the information density of a file is of interest”.
Let us first generate 1 MB of pseudo random number from <code class="docutils literal notranslate"><span class="pre">/dev/urandom</span></code>
and save them in a file. Then we run <code class="docutils literal notranslate"><span class="pre">ent</span></code> on the file. Please
describe your outcome, and analyze whether the quality of the random
numbers is good or not.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ head -c 1M /dev/urandom &gt; output.bin
$ ent output.bin
</pre></div>
</div>
<p>Theoretically speaking, the <code class="docutils literal notranslate"><span class="pre">/dev/random</span></code> device is more secure, but
in practice, there is not much difference, because the “seed” used by
<code class="docutils literal notranslate"><span class="pre">/dev/urandom</span></code> is random and non-predictable&nbsp;(<code class="docutils literal notranslate"><span class="pre">/dev/urandom</span></code> does
re-seed whenever new random data become available). A big problem of the
blocking behavior of <code class="docutils literal notranslate"><span class="pre">/dev/random</span></code> is that blocking can lead to denial
of service attacks. Therefore, it is recommended that we use
<code class="docutils literal notranslate"><span class="pre">/dev/urandom</span></code> to get random numbers. To do that in our program, we
just need to read directly from this device file. The following code
snippet shows how.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#define LEN 16  // 128 bits

unsigned char *key = (unsigned char *) malloc(sizeof(unsigned char)*LEN);
FILE* random = fopen(&quot;/dev/urandom&quot;, &quot;r&quot;);
fread(key, sizeof(unsigned char)*LEN, 1, random);
fclose(random);
</pre></div>
</div>
<p>Please modify the above code snippet to generate a 256-bit encryption
key. Please compile and run your code; print out the numbers and include
the screenshot in the report.</p>
</div>
<div class="section" id="submission">
<h2>Submission<a class="headerlink" href="#submission" title="Permalink to this headline">¶</a></h2>
<p>You need to submit a detailed lab report, with screenshots, to describe
what you have done and what you have observed. You also need to provide
explanation to the observations that are interesting or surprising.
Please also list the important code snippets followed by explanation.
Simply attaching code without any explanation will not receive credits.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="rsa.html" class="btn btn-neutral float-right" title="RSA Public-Key Encryption and Signature Lab" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="pki.html" class="btn btn-neutral float-left" title="Public-Key Infrastructure (PKI) Lab" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, NEXUS Lab.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>