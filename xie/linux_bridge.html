

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Linux Bridge &mdash; Network Security Lab  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Redacted" href="redacted.html" />
    <link rel="prev" title="Xie Labs" href="xie_labs.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Network Security Lab
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="xie_labs.html">Xie Labs</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Linux Bridge</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#task-1-linux-networking-basics">Task 1: Linux Networking Basics</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#lab-exercise-1">Lab Exercise 1</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#task-2-managing-linux-bridge">Task 2: Managing Linux Bridge</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#lab-exercise-2">Lab Exercise 2</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#what-to-submit">What to submit</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="redacted.html"><em>Redacted</em></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../seed_labs/seed_index.html">SEED Labs</a></li>
<li class="toctree-l1"><a class="reference external" href="https://taylorelder.com/projects.html">Return Back To Website</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Network Security Lab</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="xie_labs.html">Xie Labs</a> &raquo;</li>
        
      <li>Linux Bridge</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/xie/linux_bridge.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <style> .font {font-family:'Consolas'; font-size:13pt} </style><div class="section" id="linux-bridge">
<h1>Linux Bridge<a class="headerlink" href="#linux-bridge" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p><strong>Overview:</strong> Virtual networking is one of the key enablers of
enterprise and cloud networking. When dealing with virtual networks, we
usually need virtual switches for creating complex network topology.
Virtual switching solutions like Software Defined Networking (SDN) has
gained lots of attention recently for its strength in managing large and
ever-changing network infrastructures. But long before SDN came into
existence, Linux bridge was the prevalent virtual switching tool, and it
still is nowadays. A bridge, just like a physical switch, is a device to
unite network segments transparently by forwarding the network traffic
from the network devices connected to it. In this lab, we will first go
through some Linux networking concepts and tools which can later help us
understand the way Linux bridge works. Then, we will look into Linux
bridge from both application and implementation perspective.</p>
<p><strong>Objectives:</strong> Upon completing the experiments, students should:</p>
<ul class="simple">
<li><p>Understand the basic concepts of Linux networking.</p></li>
<li><p>Get familiar with some popular Linux networking tools used to analyze
network structure and traffic.</p></li>
<li><p>Learn to use Linux bridge tools to manage Linux bridges, and
understand the how the Linux bridge works.</p></li>
</ul>
<p><strong>Required Knowledge:</strong> Students are required to have the following prerequisite knowledge for this lab:</p>
<ol class="arabic simple">
<li><p>The usage of the text-based terminal and basic Linux commands.</p></li>
<li><p>Knowledge of accessing a remote Linux server using SSH.</p></li>
<li><p>Basic understanding of the use of common network devices such as
routers and switches.</p></li>
</ol>
<p id="background"><strong>Background:</strong></p>
<blockquote>
<div><p><strong>EZSetup</strong> is a novel Web application capable of creating a variety
of user-defined cybersecurity practice environments (e.g., labs and
competition scenarios) in one or more computing clouds (e.g.,
OpenStack or Amazon AWS). EZSetup provides a Web user interface for
practice designers to create a practice scenario by dragging and
dropping icons visually and the links between them thus allows for
customization and significantly reduces overhead in creating and
using practice environments. Completely spared from the complexity of
creating practice environments, end users can jump right in and fully
concentrate on cybersecurity practice.</p>
<p>For more information about EZSetup, please see bundled <a class="reference external" href="https://github.com/nexus-lab/ezsetup/wiki/User-Guide">user manual
file</a>.</p>
<p><strong>Secure Shell (SSH)</strong> is a network protocol that allows data to be
exchanged over a secure channel between two computers. Encryption
provides confidentiality and integrity of data. SSH uses public-key
cryptography to authenticate the remote computer and allow the remote
computer to authenticate the user, if necessary.</p>
<p>For more information about SSH, please see
<a class="reference external" href="https://wiki.archlinux.org/index.php/Secure_Shell">https://wiki.archlinux.org/index.php/Secure_Shell</a>.</p>
<p><strong>tcpdump</strong> is a common packet analyzer that runs under the command
line. It allows the user to display TCP/IP and other packets being
transmitted or received over a network to which the computer is
attached. Distributed under the BSD license, tcpdump is free
software.</p>
<p>For more information about tcpdump, please see its manual page:
<a class="reference external" href="https://www.tcpdump.org/manpages/tcpdump.1.html">https://www.tcpdump.org/manpages/tcpdump.1.html</a>. For tcpdump and
wireshark filtering syntax, please see
<a class="reference external" href="http://www.tcpdump.org/manpages/pcap-filter.7.html">http://www.tcpdump.org/manpages/pcap-filter.7.html</a>.</p>
<p><strong>Wireshark</strong> is a free and open-source packet analyzer. It is used
for network troubleshooting, analysis, software and communications
protocol development, and education. Wireshark is very similar to
tcpdump, but has a graphical front-end, plus some integrated sorting
and filtering options.</p>
<p>For more information about Wireshark, please see its User’s Manual:
<a class="reference external" href="https://www.wireshark.org/docs/wsug_html_chunked/">https://www.wireshark.org/docs/wsug_html_chunked/</a>.</p>
</div></blockquote>
<p><strong>Environment:</strong>
In this lab, students can access two virtual machines (VM) from EZSetup.
The first one is for Linux bridge experiments, and the second one is for
observing the network traffic. The network topology is given by <strong>Figure
1</strong>, VM properties and access information are provided in <strong>Table 1</strong> below.
Please refer to the EZSetup dashboard for the actual public IP addresses
and passwords.</p>
<div class="align-center figure" id="id1">
<img alt="alternate text" src="../_images/LB_img1.png" />
<p class="caption"><span class="caption-text"><strong>Figure 1</strong> VM properties and access information</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 26%" />
<col style="width: 11%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 24%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Name</strong></p></th>
<th class="head"><p><strong>Image</strong></p></th>
<th class="head"><p><strong>RAM</strong></p></th>
<th class="head"><p><strong>VCPU</strong></p></th>
<th class="head"><p><strong>Disk</strong></p></th>
<th class="head"><p><strong>Login
account</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>lb-vm1</p></td>
<td><p>linuxbridge-vm-1</p></td>
<td><p>2GB</p></td>
<td><p>2</p></td>
<td><p>40GB</p></td>
<td><p>See EZSetup</p></td>
</tr>
<tr class="row-odd"><td><p>lb-vm2</p></td>
<td><p>linuxbridge-vm-2</p></td>
<td><p>2GB</p></td>
<td><p>2</p></td>
<td><p>40GB</p></td>
<td><p>See EZSetup</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="task-1-linux-networking-basics">
<h2>Task 1: Linux Networking Basics<a class="headerlink" href="#task-1-linux-networking-basics" title="Permalink to this headline">¶</a></h2>
<p>A computer network is a telecommunication network for connected computer
nodes exchanging data through data links. When talking about the
composition of a computer network, people usually use conceptual models
to describe the characteristics of the network and its functions.
Network models like IBM System Network Architecture (SNA), Open Systems
Interconnection (OSI) model, and Internet protocol suite (TCP/IP) model
make it easier for people to standardize diverse communication systems
and protocols by abstract the network into several layers.</p>
<p>The seven layers of an OSI model, as described in <a class="reference download internal" download="" href="../_downloads/f57286adca47c1d59d0a1bcaa0b3926a/ISOIEC7498-1.pdf"><code class="xref download docutils literal notranslate"><span class="pre">ISOIEC</span> <span class="pre">7498-1</span></code></a>, are listed below in <strong>Table 2</strong>. These layers are identified by their functions and roles in data processing, like dealing with electric signals or routing data across the network. Each layer provides necessary interfaces to its upper layer, the higher the layer, the more abstract the data representation will be.</p>
<p><strong>Table 2</strong> Layers of OSI Model</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 54%" />
<col style="width: 26%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>Layer</strong></p></th>
<th class="head"><p><strong>Function</strong></p></th>
<th class="head"><p><strong>Example
protocols</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>7.
Application</p></td>
<td><p>Provide an interface to end users
or other applications like web
browser, and electronic mail</p></td>
<td><p>HTTP, HTTPS,
IMAP, AMPQ</p></td>
</tr>
<tr class="row-odd"><td><p>6.
Presentation</p></td>
<td><p>Data translation and formatting
between network services and
applications like data compression
and decryption</p></td>
<td><p>TLS, SSL, AFP</p></td>
</tr>
<tr class="row-even"><td><p>5.
Session</p></td>
<td><p>Manage dialogues between local and
remote applications like
connection establishment and
termination</p></td>
<td><p>SOCKS, SSH, RPC</p></td>
</tr>
<tr class="row-odd"><td><p>4.
Transport</p></td>
<td><p>Provide data segmentation,
acknowledgment mechanisms for
transmitting data segments
reliably over layer 3 network
protocols</p></td>
<td><p>TCP, UDP, iSCSI</p></td>
</tr>
<tr class="row-even"><td><p>3.
Network</p></td>
<td><p>Provide a logical addressing and
routing system to transfer data
over multiple layer 2 networks</p></td>
<td><p>ICMP, IPv4, IPv6</p></td>
</tr>
<tr class="row-odd"><td><p>2. Data
link</p></td>
<td><p>Handle node-to-node data transfer
connected to a physical layer</p></td>
<td><p>ARP, RARP, VLAN</p></td>
</tr>
<tr class="row-even"><td><p>1.
Physical</p></td>
<td><p>Define physical network devices
and transmit bit streams over them</p></td>
<td><p>USB, Wi-Fi,
Bluetooth</p></td>
</tr>
</tbody>
</table>
<p>A network interface is a software representation of physical or virtual
network device. On Linux systems, you can find available network
interfaces in <code class="docutils literal notranslate"><span class="pre">/proc/net/dev</span></code>, and access device configuration and
statistics under <code class="docutils literal notranslate"><span class="pre">/sys/class/net/</span></code> folder. On Debian-based Linux systems
like Ubuntu and Linux Mint, you can also configure network interfaces in
<code class="docutils literal notranslate"><span class="pre">/etc/network/interfaces</span></code> and files under <code class="docutils literal notranslate"><span class="pre">/etc/network/interfaces.d/</span></code>
folder. If you only want a quick look at the interfaces you have, please
use the <code class="docutils literal notranslate"><span class="pre">ifconfig</span></code> command to list all interfaces along with their
detailed information.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ifconfig -a
lo         Link encap:Local Loopback
                   inet addr:127.0.0.1 Mask:255.0.0.0
                   inet6 addr: ::1/128 Scope:Host
                   UP LOOPBACK RUNNING MTU:65536 Metric:1
                   RX packets:160 errors:0 dropped:0 overruns:0 frame:0
                   TX packets:160 errors:0 dropped:0 overruns:0 carrier:0
                   collisions:0 txqueuelen:1
                   RX bytes:11840 (11.8 KB) TX bytes:11840 (11.8 KB)
</pre></div>
</div>
<p>We can see from the output that network interface names are listed in
the left column, configurations and statistics are in the right. For
each interface, <code class="docutils literal notranslate"><span class="pre">ifconfig</span></code> will give its device type (like Ethernet or
Local Loopback), hardware address (or MAC address), IPv4 and IPv6
addresses, a network mask of each address, running status, input/output
packet numbers and sizes.</p>
<p>Since the <span class="font">ens4</span> interface is down. let’s set the IP address and bring it
up following the command lines below.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo ip addr add 10.0.0.10/16 dev ens4

$ sudo ifconfig ens4 up
</pre></div>
</div>
<p>Like sending an email to someone, if we want to transmit data to a network
interface over a network, we need some addressing mechanisms. A MAC
address, or media access control address, is a unique identifier
assigned to network interfaces for data link layer (layer 2)
communications in a network segment, which consists of 48 bits or 6
octets written in hexadecimal and separated by colons. By looking up the
MAC address, network devices like switch or router can forward the data
to the right receiver interface. However, MAC addresses are typically
used only to direct data from one device to its next device and will be
replaced by the device which forwards your data. This means MAC
addresses are usually used in the local network and do not travel far.
Also, the MAC address binds to the physical network interface, so it
will be difficult for others to find you if you switch network interface
frequently.</p>
<p>That’s where Internet Protocol (IP) addresses come into play. An IPv4
(version 4) address is a 32-bit number, which is usually written in
human-readable notations with four 8-bit decimal numbers separated by
dots. An IPv6 (version) address is much longer, using a 128 bits number
and usually written in hexadecimal with colon separators. IP addresses
work in the network layer (layer 3) and are required most of the time if
a host wants to communicate with other hosts. IP addresses within a
segment of a network, or subnet, start with the same prefix, like
192.168.0.1 and 192.168.0.2, where 192.168 is the common prefix. To
define the prefix and the size of the subnet, people often use netmasks
or CIDR (Classless Inter-Domain Routing) notations. For example, for a
subnet 192.168.0.0 to 192.168.255.255, its netmask is 255.255.0.0 and
CIDR is 192.168.0.0/16. Here, the netmask defines how many bits from the
left in an IP address is the prefix, and we can do the bitwise AND
operation of the IP address on the netmask to get the subnet prefix.
CIDR is just a compact representation of the count of leading 1 bits in
the prefix.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 65%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>11000000.10101000.00000001.00000010</p></th>
<th class="head"><p>192.168.1.2</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>AND</p></td>
<td><p>11111111.11111111.00000000.00000000</p></td>
<td><p>255.255.0.0</p></td>
</tr>
<tr class="row-odd"><td><p>=</p></td>
<td><p>11000000.10101000.00000000.00000000</p></td>
<td><p>192.168.0.0</p></td>
</tr>
</tbody>
</table>
<p>An example of sending a packet from your personal computer to a remote
web server is shown below in <strong>Figure 2</strong>. During the transmission, we also
need to find the physical location (MAC address) of a machine by its IP
address, which can be achieved by using Address Resolution Protocol
(ARP). You probably see an ARP request and response when you initiate a
connection to another machine, which you haven’t connected before.</p>
<div class="align-center figure" id="id2">
<img alt="alternate text" src="../_images/LB_img2.png" />
<p class="caption"><span class="caption-text"><strong>Figure 2</strong> Packet flow from user to the remote server</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>Linux provides a set of network tools for developers to test their
network setups. To view interface information, we can use the <code class="docutils literal notranslate"><span class="pre">ip</span></code> command
apart from the <code class="docutils literal notranslate"><span class="pre">ifconfig</span></code> command we talked about earlier.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ip a
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN
group default qlen 1
        link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
        inet 127.0.0.1/8 scope host lo
        valid_lft forever preferred_lft forever
        inet6 ::1/128 scope host
        valid_lft forever preferred_lft forever
</pre></div>
</div>
<p>To test the connectivity between your machine and another host, you can
use the <code class="docutils literal notranslate"><span class="pre">ping</span></code> command to send Internet Control Message Protocol (ICMP)
packets.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ping www.google.com -c 3
PING www.google.com (74.125.30.103) 56(84) bytes of data.
64 bytes from of-in-f103.1e100.net (74.125.30.103): icmp_seq=1 ttl=42
time=36.4 ms
64 bytes from of-in-f103.1e100.net (74.125.30.103): icmp_seq=2 ttl=42
time=34.9 ms
64 bytes from of-in-f103.1e100.net (74.125.30.103): icmp_seq=3 ttl=42
time=34.2 ms

--- www.google.com ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2002ms
rtt min/avg/max/mdev = 34.248/35.211/36.429/0.933 ms
</pre></div>
</div>
<p>Sometimes, you may want to learn more about what’s going on under the
hood, such as, what the network frames or packets are like when you
visit a website. You can use a sniffer tool to intercept and filter the
network traffic passing through your interfaces. A command-line tool
<code class="docutils literal notranslate"><span class="pre">tcpdump</span></code> is used for the network traffic sniffing. You can assign the
interface you want to inspect, and a set of rules to match the packets.
For example, if you want to listen on interface <span class="font">ens3</span>, you can run the
following command.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo tcpdump -i ens3
tcpdump: verbose output suppressed, use -v or -vv for full protocol
decode
listening on ens3, link-type EN10MB (Ethernet), capture size 262144
bytes
05:53:33.604965 IP 192.168.0.16.ssh &gt; 192.168.97.6.57405: Flags [P.],
seq 241650537:241650645, ack 3972362028, win 459, length 108
05:53:33.605016 IP 192.168.0.16.ssh &gt; 192.168.97.6.57405: Flags [P.],
seq 108:144, ack 1, win 459, length 36
05:53:33.605071 IP 192.168.0.16.ssh &gt; 192.168.97.6.57405: Flags [P.],
seq 144:252, ack 1, win 459, length 108
05:53:33.605106 IP 192.168.0.16.ssh &gt; 192.168.97.6.57405: Flags [P.],
seq 252:288, ack 1, win 459, length 36
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">sudo</span></code> command above is to make sure you have enough privilege to
execute the following command. If you are only interested in a
particular set of packets, e.g., a packet to www.google.com, you can
apply some filter rules behind the <code class="docutils literal notranslate"><span class="pre">tcpdump</span></code> command.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo tcpdump -i ens3 dst host www.google.com
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For a comprehensive list of filter syntax, you can refer back to the <a class="reference external" href="http://www.tcpdump.org/manpages/pcap-filter.7.html">pcap-filter</a> manage listed in the <a class="reference internal" href="#background"><span class="std std-ref">Background</span></a> section.</p>
</div>
<p>If you like to work in a desktop environment, Wireshark is also a great choice. Wireshark is a network protocol analyzer which lets you live capture network traffic and provide easy-to-use offline analysis functions. First, let’s open Wireshark by typing the command below in terminal window.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo wireshark-gtk
</pre></div>
</div>
<p>Or, you can start Wireshark by right-clicking on your VNC screen and
choose the Applications &gt; Internet &gt; Wireshark.</p>
<p>Before starting the capture, we need to tell Wireshark which interfaces
we want to listen on. Click the first button in the toolbar and check
one or more interfaces in the interface selection dialog. Then, press
the <code class="docutils literal notranslate"><span class="pre">Start</span></code> button to initiate the capturing process.</p>
<div class="align-center figure" id="id3">
<img alt="alternate text" src="../_images/LB_img3.png" />
<p class="caption"><span class="caption-text"><strong>Figure 3</strong> Interface selection dialog in Wireshark</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<p>Once the capture begins, we can see all the network traffic in the
packet list pane. There are several columns available, including the
packet source and destination IP or MAC address, the protocol used and
the packet length. Each line corresponds to one packet in the capture
file or stream. If you select a line in this pane, packet details will
be displayed in the packet detail and packet bytes panes. In the packet
detail pane, protocols used by the packet will show in an expandable
tree, with lower layer protocols to the top and higher layer protocols
to the bottom. You can click on any protocol to view its fields and
values, or raw bytes in the packet bytes pane.</p>
<div class="align-center figure" id="id4">
<img alt="alternate text" src="../_images/LB_img4.png" />
<p class="caption"><span class="caption-text"><strong>Figure 4</strong> Wireshark network traffic capturing window</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="lab-exercise-1">
<h3>Lab Exercise 1<a class="headerlink" href="#lab-exercise-1" title="Permalink to this headline">¶</a></h3>
<p>Log in to the first VM (lb-vm1) and answer the following questions.</p>
<ol class="arabic simple">
<li><p>What are the interfaces on your VM? What’s their MAC and IP
addresses? What’s their MTU (Maximum Transmission Unit) value?</p></li>
<li><p>What are the netmask and IP range for the subnet 10.0.0.0/23?</p></li>
<li><p>Can you connect to the host 192.168.0.1? What about 192.168.0.9? What
command do you use? If you cannot connect to a host, what does the
reply say?</p></li>
<li><p>Before we move on, clear <strong>all</strong> of your browser history by opening the Application Menu in Firefox &gt; History &gt; Clear Recent History… &gt; Set time range to clear: Everything, and check all boxes. Close your browser when this is completed. Now, open Wireshark and start capture on the <span class="font">ens3</span> interface. Then visit <a class="reference external" href="http://ualr.edu">http://ualr.edu</a>. How do you filter out all the HTTP request to ualr.edu? What is the IP address of the Web server? What is the “Accept-Encoding” field in the Hypertext Transfer Protocol in the first HTTP request?</p></li>
</ol>
<blockquote>
<div><div class="admonition-hint admonition">
<p class="admonition-title">Hint</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">http.host</span></code> as the display filter.</p>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="task-2-managing-linux-bridge">
<h2>Task 2: Managing Linux Bridge<a class="headerlink" href="#task-2-managing-linux-bridge" title="Permalink to this headline">¶</a></h2>
<p>Bridging is “plugging” one or more network interfaces into another
network interface which has the connectivity to a larger network. Just
imagine the dorm room in your college only has a limited number of
ethernet jacks and no router, so you and your roommate can bridge your
computers to a single ethernet port to join the Internet. The job of the
bridge is to examine the data packet destination and decide where should
it be passed to, or whether it should drop the packet, by looking at the
MAC address of plugged network interfaces.</p>
<p>Linux bridge is a software bridge which emulates the behavior of a
hardware bridge and provides additional powerful features like
firewalling. You can check if your system has the bridge kernel module
by the following command.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ modinfo bridge
filename: /lib/modules/4.4.0-97-generic/kernel/net/bridge/bridge.ko
alias: rtnl-link-bridge
version: 2.3
license: GPL
srcversion: E093FB4EB1EE49C1B0F6A2F
depends: stp,llc
intree: Y
vermagic: 4.4.0-97-generic SMP mod_unload modversions
</pre></div>
</div>
<p>If it shows no errors, you can manage bridges either using the <code class="docutils literal notranslate"><span class="pre">brctl</span></code>
command in the bridge-utilities package or the ip command. We will be
using <code class="docutils literal notranslate"><span class="pre">brctl</span></code> in the rest of the instructions.</p>
<p>First, let’s see all subcommands <code class="docutils literal notranslate"><span class="pre">brctl</span></code> offers.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ brctl
Usage: brctl [commands]
commands:
        addbr &lt;bridge&gt; add bridge
        delbr &lt;bridge&gt; delete bridge
        addif &lt;bridge&gt; &lt;device&gt; add interface to bridge
        delif &lt;bridge&gt; &lt;device&gt; delete interface from bridge
        hairpin &lt;bridge&gt; &lt;port&gt; {on|off} turn hairpin on/off
        setageing &lt;bridge&gt; &lt;time&gt; set ageing time
        setbridgeprio &lt;bridge&gt; &lt;prio&gt; set bridge priority
        setfd &lt;bridge&gt; &lt;time&gt; set bridge forward delay
        sethello &lt;bridge&gt; &lt;time&gt; set hello time
        setmaxage &lt;bridge&gt; &lt;time&gt; set max message age
        setpathcost &lt;bridge&gt; &lt;port&gt; &lt;cost&gt; set path cost
        setportprio &lt;bridge&gt; &lt;port&gt; &lt;prio&gt; set port priority
        show [ &lt;bridge&gt; ] show a list of bridges
        showmacs &lt;bridge&gt; show a list of mac addrs
        showstp &lt;bridge&gt; show bridge stp info
        stp &lt;bridge&gt; {on|off} turn stp on/off
</pre></div>
</div>
<p>To create a bridge, you can use the <code class="docutils literal notranslate"><span class="pre">addbr</span></code> subcommand followed by the
bridge name.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo brctl addbr br0
</pre></div>
</div>
<p>The above command will add a bridge named <span class="font">br0</span>. The bridge will show as a
network interface, and you can check it by command <code class="docutils literal notranslate"><span class="pre">ifconfig</span> <span class="pre">br0</span></code>, or you
can show all the bridges using</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ brctl show
bridge name    bridge id            STP enabled    interfaces
br0            8000.000000000000    no
</pre></div>
</div>
<p>Deleting a bridge is just as simple as creating a bridge. You can use
<code class="docutils literal notranslate"><span class="pre">brctl</span> <span class="pre">delbr</span></code> with the bridge name</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo brctl delbr br0
</pre></div>
</div>
<p>Now, let’s try to plug an interface to the bridge.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Please be careful with the interface name when you enter the command. Adding an interface to a bridge will make the interface lose network connection temporarily, and the first ethernet interface, which is <span class="font">ens3</span>, is the channel for the VM to communicate with you. So, make sure you don’t operate on the <span class="font">ens3</span> interface, or you will lose the connection to your VM.</p>
</div>
<p>Enter the following command to add the second ethernet interface <span class="font">ens4</span> to bridge <span class="font">br0</span>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo brctl addif br0 ens4
</pre></div>
</div>
<p>You can check the bridge details once again using <code class="docutils literal notranslate"><span class="pre">brctl</span> <span class="pre">show</span></code>. Also, if
you want to remove an interface from a bridge, you can run the following
command.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo brctl delif br0 ens4
</pre></div>
</div>
<p>After you add the interface to the bridge, we may test the interface
connectivity to its subnet by pinging the other VM (lb-vm2).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ping -I ens4 10.0.0.1 -c 3
PING 10.0.0.1 (10.0.0.1) from 10.0.0.10 ens4: 56(84) bytes of data.
From 10.0.0.10 icmp_seq=1 Destination Host Unreachable
From 10.0.0.10 icmp_seq=2 Destination Host Unreachable
From 10.0.0.10 icmp_seq=3 Destination Host Unreachable
--- 10.0.0.1 ping statistics ---
3 packets transmitted, 0 received, +3 errors, 100% packet loss, time
2014ms
pipe 3
</pre></div>
</div>
<p>Right now, you should receive <code class="docutils literal notranslate"><span class="pre">Destination</span> <span class="pre">Host</span> <span class="pre">Unreachable</span></code> error,
which means <span class="font">ens4</span> cannot send or receive packets from other hosts on the
same subnet. This can be explained with the first two figures in <strong>Figure
5</strong>.</p>
<div class="align-center figure" id="id5">
<img alt="alternate text" src="../_images/LB_img5.png" />
<p class="caption"><span class="caption-text"><strong>Figure 5</strong> Steps of connecting a virtual host to the Linux bridge</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
<p>At first, the system connects to the subnet via <span class="font">ens4</span> directly. When we
add <span class="font">ens4</span> to the bridge, we cut down the connection between the system
and <span class="font">ens4</span>, and right now the system still tries to send packets to <span class="font">ens4</span>
instead of <span class="font">br0</span>. To re-establish the connection, we should tell the
system to send all traffic within the subnet to <span class="font">br0</span>. To do this, we need
to move the IP address of <span class="font">ens4</span> to <span class="font">br0</span> and bring up the bridge interface.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo ip addr del 10.0.0.10/16 dev ens4

$ sudo ip addr add 10.0.0.10/16 dev br0

$ sudo ip link set br0 up
</pre></div>
</div>
<p>Now, you should be able to ping other hosts in the subnet. Let’s try to
add some more interfaces to the bridge and see if it works. Move to the
<code class="docutils literal notranslate"><span class="pre">~/labs/linux_bridge</span></code> directory and run the following command to add two
virtual hosts <span class="font">h1</span> and <span class="font">h2</span> to your VM.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ./start.sh

=======================================

Virtual Hosts Activated!

Type exit to quit.

=======================================
</pre></div>
</div>
<p>You can use <code class="docutils literal notranslate"><span class="pre">&lt;host</span> <span class="pre">name&gt;</span> <span class="pre">&lt;command&gt;</span></code> to execute network-related commands
as if they are executed in another machine. No sudo is need here. For
example, you can list interfaces of <span class="font">h1</span> using</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ h1 ifconfig -a
</pre></div>
</div>
<p>Or ping another host using</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ h2 ping 10.0.0.12 -c 3
</pre></div>
</div>
<p>Note here, however, that you should still receive <code class="docutils literal notranslate"><span class="pre">Destination</span> <span class="pre">Host</span>
<span class="pre">Unreachable</span></code> because although running <code class="docutils literal notranslate"><span class="pre">./start.sh</span></code> has added <span class="font">h1</span> and <span class="font">h2</span> to
the VM, we still need to connect them to the subnet.</p>
<p>Also, you can still execute commands in the host VM by simply typing
commands without host name.</p>
<p>If you list interfaces on the host VM, you will find there are two new
interfaces added, which are <span class="font">p-h1</span> and <span class="font">p-h2</span>. Each of the <span class="font">p-*</span> interfaces are one end of a tunnel which connects the virtual host and the VM. Packets from the virtual hosts can reach the VM through this tunnel, and vice versa. <strong>Figure 6</strong> depicts current network topology.</p>
<p>Now, to connect <span class="font">h1</span> and <span class="font">h2</span> to the subnet, we need to add the VM side <span class="font">p-h1</span> and <span class="font">p-h2</span> to the bridge. This should be done in the Virtual Host application.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sudo brctl addif br0 p-h1

$ sudo brctl addif br0 p-h2
</pre></div>
</div>
<p>This will connect <span class="font">p-h1</span> and <span class="font">p-h2</span> to the bridge <span class="font">br0</span>, and also make it possible for virtual host <span class="font">h1</span> to communicate with other hosts in the subnet. Now you should be able to ping other hosts using the command listed above.</p>
<p>Remember to use the <code class="docutils literal notranslate"><span class="pre">exit</span></code> command once you are done with tinkering the
virtual hosts.</p>
<div class="align-center figure" id="id6">
<img alt="alternate text" src="../_images/LB_img6.png" />
<p class="caption"><span class="caption-text"><strong>Figure 6</strong> Network structure of the host VM and virtual hosts</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="lab-exercise-2">
<h3>Lab Exercise 2<a class="headerlink" href="#lab-exercise-2" title="Permalink to this headline">¶</a></h3>
<p>Activate virtual hosts using the <code class="docutils literal notranslate"><span class="pre">start.sh</span></code> script and try to connect both
hosts to the network. Then answer the following questions.</p>
<ol class="arabic simple">
<li><p>What’s the MAC address of the bridge interface?</p></li>
<li><p>What commands do you use to connect the virtual hosts to the
network? What are the IP and MAC addresses of the virtual hosts?</p></li>
<li><p>Open Wireshark on the second VM (lb-vm2) and listen on the <span class="font">ens3</span>
interface. Then, try to ping it from virtual host <span class="font">h1</span>. What’s the
IP and MAC address of the incoming packets do you see in
Wireshark? What does this mean?</p></li>
<li><p>On the first VM (lb-vm1), use tcpdump to capture traffic on <span class="font">ens4</span>.
Then, try to ping the second VM (lb-vm2) and <span class="font">h2</span> from <span class="font">h1</span>
successively. What commands do you use? What do you observe and
what does it mean?</p></li>
</ol>
</div>
</div>
<div class="section" id="what-to-submit">
<h2>What to submit<a class="headerlink" href="#what-to-submit" title="Permalink to this headline">¶</a></h2>
<p>Save your answers (with screenshots) to the above questions into a PDF
file and name the file as <code class="docutils literal notranslate"><span class="pre">linux-bridge-ans.pdf</span></code>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="redacted.html" class="btn btn-neutral float-right" title="Redacted" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="xie_labs.html" class="btn btn-neutral float-left" title="Xie Labs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, NEXUS Lab.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>